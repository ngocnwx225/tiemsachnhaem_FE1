<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../assets/css/style_qlkh.css">
</head>
<body>
    <div class="customer-management">
        <h2>Quản lý khách hàng</h2>
        <div class="search-bar">
            <input type="text" placeholder="Tìm theo tên, email, số điện thoại...">
            <select>
                <option>Tất cả trạng thái</option>
                <option>Hoạt động</option>
                <option>Bị khóa</option>
            </select>
        </div>
        <div class="table">
            <div class="table-header">
                <div class="table-column">Khách hàng</div>
                <div class="table-column">Số đơn hàng</div>
                <div class="table-column">Tổng chi tiêu</div>
                <div class="table-column">Trạng thái</div>
                <div class="table-column">Thao tác</div>
            </div>
            <div class="table-row" id="customer-1">
                <div class="table-column">Nguyễn Văn A<br><small>nguyenvana@example.com<br>0901234567</small></div>
                <div class="table-column">5</div>
                <div class="table-column">3.250.000đ</div>
                <div class="table-column"><span class="status active" id="status-1">Hoạt động</span></div>
                <div class="table-column action-buttons">
                    <span class="action-link view-btn" data-customer='{"id":1,"name":"Nguyễn Văn A","email":"nguyenvana@example.com","phone":"0901234567","address":"123 Nguyễn Văn Linh, Quận 7, TP.HCM","orders":5,"total":"3.250.000đ","latestOrder":"12/07/2023","earliestOrder":"10/01/2023","status":"Hoạt động","orderHistory":[{"id":"12345","date":"12/07/2023","total":"850.000đ","status":"Đã giao"},{"id":"11234","date":"01/06/2023","total":"720.000đ","status":"Đã giao"},{"id":"10123","date":"15/04/2023","total":"1.200.000đ","status":"Đã giao"}]}'>Xem</span>
                    <span class="action-link danger" onclick="lockAccount(this)">Khoá</span>
                </div>
            </div>
            <div class="table-row" id="customer-2">
                <div class="table-column">Trần Thị B<br><small>tranb@example.com<br>0907654321</small></div>
                <div class="table-column">3</div>
                <div class="table-column">1.750.000đ</div>
                <div class="table-column"><span class="status active" id="status-2">Hoạt động</span></div>
                <div class="table-column action-buttons">
                    <span class="action-link view-btn" data-customer='{"id":2,"name":"Trần Thị B","email":"tranb@example.com","phone":"0907654321","address":"456 Trần Phú, Quận 5, TP.HCM","orders":3,"total":"1.750.000đ","latestOrder":"10/06/2023","earliestOrder":"01/05/2023","status":"Hoạt động","orderHistory":[{"id":"12346","date":"10/06/2023","total":"850.000đ","status":"Đã giao"},{"id":"11235","date":"01/05/2023","total":"900.000đ","status":"Đã giao"}]}'>Xem</span>
                    <span class="action-link danger" onclick="lockAccount(this)">Khoá</span>
                </div>
            </div>
            <div class="table-row" id="customer-3">
                <div class="table-column">Lê Văn C<br><small>levanc@example.com<br>0989765432</small></div>
                <div class="table-column">2</div>
                <div class="table-column">1.520.000đ</div>
                <div class="table-column"><span class="status inactive" id="status-3">Bị khóa</span></div>
                <div class="table-column action-buttons">
                    <span class="action-link view-btn" data-customer='{"id":3,"name":"Lê Văn C","email":"levanc@example.com","phone":"0989765432","address":"789 Lê Lợi, Quận 1, TP.HCM","orders":2,"total":"1.520.000đ","latestOrder":"01/05/2023","earliestOrder":"15/03/2023","status":"Bị khóa","orderHistory":[{"id":"12347","date":"01/05/2023","total":"720.000đ","status":"Đã giao"},{"id":"10124","date":"15/03/2023","total":"800.000đ","status":"Đã giao"}]}'>Xem</span>
                    <span class="action-link danger" onclick="lockAccount(this)">Khoá</span>
                </div>
            </div>
            <div class="table-row" id="customer-4">
                <div class="table-column">Phạm Thị D<br><small>phamthid@example.com<br>0908765432</small></div>
                <div class="table-column">1</div>
                <div class="table-column">450.000đ</div>
                <div class="table-column"><span class="status active" id="status-4">Hoạt động</span></div>
                <div class="table-column action-buttons">
                    <span class="action-link view-btn" data-customer='{"id":4,"name":"Phạm Thị D","email":"phamthid@example.com","phone":"0908765432","address":"101 Hà Nội, Quận 3, TP.HCM","orders":1,"total":"450.000đ","latestOrder":"15/04/2023","earliestOrder":"15/04/2023","status":"Hoạt động","orderHistory":[{"id":"12348","date":"15/04/2023","total":"450.000đ","status":"Đã giao"}]}'>Xem</span>
                    <span class="action-link danger" onclick="lockAccount(this)">Khoá</span>
                </div>
            </div>
            <div class="table-row" id="customer-5">
                <div class="table-column">Hoàng Văn E<br><small>hoangvane@example.com<br>0910123456</small></div>
                <div class="table-column">4</div>
                <div class="table-column">2.950.000đ</div>
                <div class="table-column"><span class="status active" id="status-5">Hoạt động</span></div>
                <div class="table-column action-buttons">
                    <span class="action-link view-btn" data-customer='{"id":5,"name":"Hoàng Văn E","email":"hoangvane@example.com","phone":"0910123456","address":"202 Sài Gòn, Quận 10, TP.HCM","orders":4,"total":"2.950.000đ","latestOrder":"20/03/2023","earliestOrder":"01/01/2023","status":"Hoạt động","orderHistory":[{"id":"12349","date":"20/03/2023","total":"1.200.000đ","status":"Đã giao"},{"id":"11236","date":"01/02/2023","total":"750.000đ","status":"Đã giao"},{"id":"10125","date":"01/01/2023","total":"1.000.000đ","status":"Đã giao"}]}'>Xem</span>
                    <span class="action-link danger" onclick="lockAccount(this)">Khoá</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal chính -->
    <div class="modal-overlay" id="modalOverlay"></div>
    <div class="modal" id="customerModal">
        <div class="modal-header">
            <h2>Thông tin khách hàng</h2>
            <span class="modal-close" id="modalClose">×</span>
        </div>
        <div class="modal-content">
            <div><span class="label">Tên:</span><span id="modalName"></span></div>
            <div><span class="label">Email:</span><span id="modalEmail"></span></div>
            <div><span class="label">Số điện thoại:</span><span id="modalPhone"></span></div>
            <div><span class="label">Địa chỉ:</span><span id="modalAddress"></span></div>
            <div><span class="label">Ngày đăng ký:</span><span id="modalRegisterDate"></span></div>
            <div><span class="label">Trạng thái:</span><span id="modalStatus"></span></div>
            <div><span class="label">Thông tin mua hàng</span></div>
            <div><span class="label">Tổng số đơn hàng:</span><span id="modalOrders"></span></div>
            <div><span class="label">Tổng chi tiêu:</span><span id="modalTotal"></span></div>
            <div><span class="label">Đơn hàng gần nhất:</span><span id="modalLatestOrder"></span></div>
            <div><span class="label">Đơn hàng gần đây nhất:</span><span id="modalEarliestOrder"></span></div>
            <div><span class="label">Lịch sử đơn hàng</span></div>
            <div id="modalOrderHistory"></div>
        </div>
        <div class="modal-actions">
            <button class="lock-btn" onclick="lockAccount()">Khóa tài khoản</button>
            <button class="close-btn">Đóng</button>
        </div>
    </div>

    <!-- Popup xác nhận khóa tài khoản -->
    <div class="confirm-modal" id="confirmModal">
        <h3>Xác nhận khóa tài khoản</h3>
        <p>Bạn có chắc chắn muốn khóa tài khoản này không?</p>
        <div class="confirm-actions">
            <button class="confirm-cancel" onclick="closeConfirmModal()">Hủy</button>
            <button class="confirm-lock" onclick="confirmLockAccount()">Khóa</button>
        </div>
    </div>

    <!-- Popup thông báo khóa thành công -->
    <div class="success-modal" id="successModal">
        <div class="success-icon">✔</div>
        <h3>Khóa thành công</h3>
        <p>Bạn đã thực hiện khóa tài khoản thành công. Hãy kiểm tra lại trạng thái của bạn.</p>
        <div class="success-actions">
            <button class="success-cancel" onclick="closeSuccessModal()">Hủy</button>
            <button class="success-ok" onclick="closeSuccessModal()">OK</button>
        </div>
    </div>

    <script>
        // Lấy tất cả các nút "Xem"
        const viewButtons = document.querySelectorAll('.view-btn');
        const modal = document.getElementById('customerModal');
        const modalOverlay = document.getElementById('modalOverlay');
        const modalClose = document.getElementById('modalClose');
        const closeBtn = document.querySelector('.close-btn');
        let currentCustomerData = null;
        const confirmModal = document.getElementById('confirmModal');
        const successModal = document.getElementById('successModal');

        // Hiển thị modal với dữ liệu khách hàng
        viewButtons.forEach(button => {
            button.addEventListener('click', () => {
                currentCustomerData = JSON.parse(button.getAttribute('data-customer'));
                document.getElementById('modalName').textContent = currentCustomerData.name;
                document.getElementById('modalEmail').textContent = currentCustomerData.email;
                document.getElementById('modalPhone').textContent = currentCustomerData.phone;
                document.getElementById('modalAddress').textContent = currentCustomerData.address;
                document.getElementById('modalRegisterDate').textContent = currentCustomerData.earliestOrder;
                document.getElementById('modalStatus').textContent = currentCustomerData.status;
                document.getElementById('modalOrders').textContent = currentCustomerData.orders;
                document.getElementById('modalTotal').textContent = currentCustomerData.total;
                document.getElementById('modalLatestOrder').textContent = currentCustomerData.latestOrder;
                document.getElementById('modalEarliestOrder').textContent = currentCustomerData.earliestOrder;

                const orderHistoryDiv = document.getElementById('modalOrderHistory');
                orderHistoryDiv.innerHTML = '';

                // Tạo bảng lịch sử đơn hàng
                const table = document.createElement('table');
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th>Mã đơn</th>
                            <th>Ngày đặt</th>
                            <th>Tổng tiền</th>
                            <th>Trạng thái</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${currentCustomerData.orderHistory.map(order => `
                            <tr>
                                <td>#${order.id}</td>
                                <td>${order.date}</td>
                                <td>${order.total}</td>
                                <td class="status-column"><span class="status ${order.status === 'Đã giao' ? 'active' : 'inactive'}">${order.status}</span></td>
                            </tr>
                        `).join('')}
                    </tbody>
                `;
                orderHistoryDiv.appendChild(table);

                modal.style.display = 'block';
                modalOverlay.style.display = 'block';
            });
        });

        // Đóng modal
        modalClose.addEventListener('click', () => {
            modal.style.display = 'none';
            modalOverlay.style.display = 'none';
        });

        closeBtn.addEventListener('click', () => {
            modal.style.display = 'none';
            modalOverlay.style.display = 'none';
        });

        modalOverlay.addEventListener('click', () => {
            modal.style.display = 'none';
            modalOverlay.style.display = 'none';
        });

        // Hàm mở popup xác nhận khóa tài khoản
        function lockAccount() {
            if (currentCustomerData && currentCustomerData.status === 'Hoạt động') {
                confirmModal.style.display = 'block';
            } else if (currentCustomerData && currentCustomerData.status === 'Bị khóa') {
                alert('Tài khoản đã bị khóa rồi!');
            }
        }

        // Hàm đóng popup xác nhận
        function closeConfirmModal() {
            confirmModal.style.display = 'none';
        }

        // Hàm xác nhận khóa tài khoản
        function confirmLockAccount() {
            if (currentCustomerData) {
                currentCustomerData.status = 'Bị khóa';
                document.getElementById('modalStatus').textContent = 'Bị khóa';

                // Cập nhật trạng thái ở bảng chính
                const statusElement = document.getElementById(`status-${currentCustomerData.id}`);
                if (statusElement) {
                    statusElement.textContent = 'Bị khóa';
                    statusElement.classList.remove('active');
                    statusElement.classList.add('inactive');
                }

                // Hiển thị popup thông báo thành công
                successModal.style.display = 'block';
                closeConfirmModal();
            }
        }

        // Hàm đóng popup thông báo thành công
        function closeSuccessModal() {
            successModal.style.display = 'none';
        }
    </script>
</body>
</html>